language: php

env:
  global:
    - setup=stable

matrix:
  fast_finish: true
  include:
    - php: 7.1
      env: setup=lowest
    - php: 7.2
      env: setup=lowest
    - php: 7.3
      env: setup=lowest

sudo: false

cache:
  directories:
    - $HOME/.composer/cache

services:
    - memcached
    - redis-server
    - mysql

before_install:
    - mysql -e 'create database tech_bench;'
    - mysql -e 'create database tb-dev-testing;'
    
before_script:
    - cp tests/.env.travis .env
    - composer self-update
    - composer install --no-interaction
    - pear install pear/PHP_CodeSniffer
    - phpenv rehash
    - npm install npm@latest -g
    - npm install -g jshint
    - npm install
    - php artisan key:generate
    - php artisan migrate --seed

script: 
    - npm run production
    - vendor/bin/phpunit
